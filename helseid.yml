services:
  redis:
    image: redis:7
    ports:
      - "6379:6379"
  wonderwall:
    image: ghcr.io/nais/wonderwall:latest
    ports:
      - "3000:3000"
    command: >
      --auto-login=true
      --openid.client-id=90112420-3cc1-4452-9daa-cb1e32947ac4 
      --openid.client-jwk='{ "alg": "RS256", "d": "ANpEFxkoEcw4cMkYQrD3KBKhe5nslAGNsZPkZKxSvrv_TgfZVg_Y1mVLxPDJJAcP5sxZn2QTqr947QU2tbjQH4g8LuN-qvxf1gYIFHZRyQBhAjppai4nP-uBHpPWAVubg2oO5R7MnE6AYA3nK-JAjQpbTy7xcKkPz6csk5sI7htJOTYkUcFu37mM8M7r6a2x_8EmaaqcEBhbBarM-46Ws8v3bf-ssWJeaGZH7htb1t4rdFHBad0HD3C0M85-qVyTw7YBMB-wW-FjNuow626B0EkXdf2EMkwxm-vGkzlZYVO8hka1SvdUnTuqW1UxcrOXNvmSiG51Qh6tksVFvGXc1p4Um1uO04aKRRDktg33HTaIcpwhHWLs_6wCLz8EAGV4ik5zpf0WpnUHC4MtE1UdiBnQhakZ6OVbhZHKSJmLzdG5YH0GKJyH_owQ4XBHu7LbzhquLQsmhLOBhSKBB0PbU_lM-pD6A3CWRgmVc5N4z_CQ-3sLpZuDDqpX4FXeYt8ci5cKaK67ts_7xX4Rt_Qz-r65mvkPIE9AZIxdaZ5eVycghc8j7UnMu4fvkP7B9zB2OVICUgUv6GZVT6OK6S2pYYO3T_KFC3EcYcho0jdqvk5ImDTEAKJozV0FejHYfZrfBaDba6abzFQcD2jL1NsevFiGfz1gjTheN5S7OCW8LJE", "dp": "4i___XrRaRz00AUht-uRsSIxld1SwdMTxWHkB1sAI9P05HS0oLgdvY3D_PpTJUYDU8oD1UGeRvk5KEhS7zbHiQnRGE9IqvorPEM8IBOc1d2TtdGZPJ4Gyu2T9j7o8tDLlC8-wG1lj61REHzq8RZa_3teDNgsmS0VezMIdrWIpkCBjyecwGedkA9qpcgmm8eryLOjLqiTPXA4EaomVnAWRcNoE_btFtOSgnw31KfcKNSbtoLVkPtuKsii9woquK6giRotrHjLWnPBt1sKbNyUEtd9BzN4QGhQT9ADCAy9oB82ndizVsrZoJmTaJm5_M4I2863FlPfqUcw7KWGd5pXPw", "dq": "DY4eDcVQOUNA0gsrHTOfKSBunhbye_cTNNG18mZ6jLssQMt301zrlJsgMwCSzsGyZrs0SdCb7Qn_K2i62XVR3J9FrBPKOHs6lKBVssjh9H-_xbnYHopc7GBVmYdVxwMcQ4km7D9twsSioBBS8EmLQNr6ZoPARcCKOdFS-WNAyyTYLroqzTzf-04wNh1gxQ-vMKKcoBc2ufrQuCnEf-eKwU2pY2Q41qk0hWY3MBChTYwZfw2uuF3togOROZ3J62Y2XssEfnJjlD0g1SGpwZTqWNDnD25Zsr55nsAU_oq7G1EaZGOiMhn5SiLWOaUzqKUajtNZusZnfCu2hOLvEW8p1Q", "e": "AQAB", "kty": "RSA", "n": "okKx_Yme-xVwm-VHq6sr8-ZMWcICAqv5DiT01GR6PVGH6Q2U9vOfifif7x1ZQKiL3Mq1WyBYRRh1Gnt5lt3M8DMK8G3WO0Vzd1tET9URIP3E9rJHCe01CRDOwcT2KQGv0T08gfR3E_qn2FnpMBupNU3QIPHuaEXMUVrdcLD9oprMv2-wLjns4IRzlMCq_thqj2Dgsmheq-I3J_a3C5-lsCmZQfO1ZHPIgTUdNXWf2MI1voV4BNosiS9kQBk9ZTEBiogcN3SRg2ql4daZNfpGb7wXK45DbEAaPXXXYoDruDeSi9wHUdpwMz0JiPIk6mgHeIDz-wuZiYVX5wBkfTMaLqZnmeG0aF-ZVX3QKWjlyP0uC6TNEbD_E6ddslrrcZGgnYCKBnoTujjgzKpKQ7bWLyFBCmG9iNf1LR3cBKp4YHoHiLmAKygaqQroat5Dl7Gn4ZDQhNJaLoTs3HAhsG9_Jkh8hWCN8MFY992PPFnjI1k7qwKNzQFGSKPcwFXpe___cQ6CAPLgOg3O6X4F4OTsoOerkemn5Cp5KvNgXIY_pZ_AcoymQ9zEaWrnfxoWdkADIN-N7O6e-02itozAoXIeElSJ5dxMNh8jRcqkmPouiQKA6X4AL2C_PwWPZ5PQ4with4bcieALUDXNpJKWHhpnA8dtdG4X5-rAz9a241oiqgs", "p": "5OI3epDxawOp9dlfZ2Gkr7EE2ap0_X1F4e0Wc939D_s6WSQQs7oHuvONDIsXBfAKiYmQ7sSNfrww6M6hiAZh-OHqh3ZabJfjqRSxtoh58LprA7FubcvwnqIhLb-nZuSg9b7w_32dTdRHD9KizlS1M5CqON-Cl6hu7mBwG2By1aKQaJQiCoob6b3xxFUYrUAPfwsKIc-WFwrbNBAEPVs2ar0lf01nK3iVgFArxLESGjW0SRarWeCu1MGQtoLNtF-VFbspdIBWV0f58N0r4xPl3LM_t5Zpc3dREUdcxHNtTxH54J7Peluylk3gjXcwjcL32k4L8wfmyTbaZ5x_cPH3lw", "q": "tXvfx0aM0SprEfAOqbGtGBaUWFx-S7RwHze82taTwOnt5zIvvU5xxrfRdhPdB5wQ948xlGrHjUDpvf6MlmstBpi58EhKsjQlBQQmBu8KsFWS-6OiF6n-XXhxD8ppCHdpT2kXWI8xbqGsrFHzlcFSmY9PhOXW-OCsFHo1zMJ0VQSei8JeNdmtRglIqHvIsQBGTjpTgTh4-dttgu2SyLkQ1Pr2ls7MoxF6JecIObpOP1qv_d14p5j478xKHcIowAvOrtp3ALnej9tyfpZ0y3mxv2y4vCNppb4ExVuqXjojJZ0JVbfb5nzAdp57jcAo46RU7b484bnvFd77y5GLL1ePrQ", "qi": "bzgB4cM8Y0rQF6GoHgkEGAEfIGY8wkByKLlMDrJ1VOK0HVp2M0I8tYsKcMIxdWkRDywvx2Qu_ClXNSpcRRkB6mlglj2gULWkxLw4plXlAZg5gpRzUyKk-zyE1K7u2VuzahwHQoZTEFRji9pe_DbS8c9QXAEFsvI2IF9ILohlBZER-7Z9Bp3WRkxSGqWOr6vjoKugZP2T5NJojH9vTf7f7vbAnUJWARJB52cvUAoGHJ5H14QTAa-uPzQP9xj32jlT3g16spNNLxQFLZeyKFoA8jYhgEKPRJQBdTSkVa7JxSeI35quebBY1eGx_mzhQvGrMBRF3rbh-kGgrnEOB3_KWg" }' 
      --openid.well-known-url=https://helseid-sts.test.nhn.no/.well-known/openid-configuration
      --ingress=http://localhost:3000
      --bind-address=0.0.0.0:3000
      --upstream-host=upstream:4000
      --redis.uri=redis://redis:6379
      --log-level=debug
      --log-format=text
    restart: on-failure
    extra_hosts:
      # Wonderwall needs to both reach and redirect user agents to the mock-oauth2-server:
      # - 'mock-oauth2-server:8888' resolves from the container, but is not resolvable for user agents at the host (e.g. during redirects).
      # - 'localhost:8888' allows user agents to resolve redirects to the mock-oauth2-server, but breaks connectivity from the container itself.
      # This additional mapping allows the container to reach the mock-oauth2-server at 'localhost' through the host network, as well as allowing user agents to correctly resolve redirects.
      - localhost:host-gateway
  upstream:
    image: mendhak/http-https-echo:30
    ports:
      - "4000:4000"
    environment:
      HTTP_PORT: 4000
      JWT_HEADER: Authorization
      LOG_IGNORE_PATH: /
